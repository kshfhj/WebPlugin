import{d as p,T as c,i as R,a as U,b as a,c as $,e as A,g as E,f as z}from"./security-6RDsp77e.js";class P{observer=null;threatCallback;settings=null;initialize(){this.setupDOMObserver(),console.log("ğŸ‘ï¸ DOM Observer initialized")}setThreatCallback(t){this.threatCallback=t}setSettings(t){this.settings=t}setupDOMObserver(){this.observer=new MutationObserver(t=>{t.forEach(e=>{this.handleMutation(e)})}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src","href","onclick","onload","onerror"],characterData:!0})}handleMutation(t){switch(t.type){case"childList":this.handleChildListMutation(t);break;case"attributes":this.handleAttributeMutation(t);break;case"characterData":this.handleCharacterDataMutation(t);break}}handleChildListMutation(t){t.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&this.analyzeAddedElement(e)})}handleAttributeMutation(t){const e=t.target,n=t.attributeName;if(!n)return;const i=e.getAttribute(n);i&&this.isDangerousAttribute(n,i)&&this.reportThreat({id:`dangerous_attribute_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å±æ€§: ${n}="${i.substring(0,50)}"`,timestamp:Date.now(),blocked:!1,details:{element:e.tagName,attribute:n,value:i.substring(0,200)}})}handleCharacterDataMutation(t){const n=t.target.textContent||"",i=p(n);i.detected&&this.reportThreat({id:`text_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:"æ£€æµ‹åˆ°æ–‡æœ¬å†…å®¹ä¸­çš„XSSæ¨¡å¼",timestamp:Date.now(),blocked:!1,details:{content:n.substring(0,200),patterns:i.patterns.map(s=>s.id)}})}analyzeAddedElement(t){t.tagName==="SCRIPT"&&this.analyzeScriptElement(t),t.tagName==="IFRAME"&&this.analyzeIframeElement(t),t.tagName==="FORM"&&this.analyzeFormElement(t);const e=t.innerHTML;if(e){const n=p(e);n.detected&&this.reportThreat({id:`dynamic_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"high",url:window.location.href,description:"æ£€æµ‹åˆ°åŠ¨æ€æ·»åŠ çš„XSSå†…å®¹",timestamp:Date.now(),blocked:!1,details:{element:t.tagName,content:e.substring(0,200),patterns:n.patterns.map(i=>i.id)}})}t.querySelectorAll("*").forEach(n=>{this.analyzeAddedElement(n)})}analyzeScriptElement(t){const e=t.src,n=t.textContent||t.innerHTML;if(e){if(!this.isTrustedDomain(e)){const i=this.checkIfMaliciousUrl(e);this.reportThreat({id:`dynamic_external_script_${Date.now()}`,type:i?"malicious_url":"suspicious_script",level:"high",url:window.location.href,description:i?`æ£€æµ‹åˆ°æ¶æ„è„šæœ¬: ${new URL(e).hostname}`:`åŠ¨æ€åŠ è½½å¤–éƒ¨è„šæœ¬: ${new URL(e).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:e}})}}else n&&this.reportThreat({id:`dynamic_inline_script_${Date.now()}`,type:"suspicious_script",level:"high",url:window.location.href,description:"åŠ¨æ€æ·»åŠ å†…è”è„šæœ¬",timestamp:Date.now(),blocked:!1,details:{content:n.substring(0,200)}})}analyzeIframeElement(t){const e=t.src;if(e&&!this.isTrustedDomain(e)){const n=this.checkIfMaliciousUrl(e);this.reportThreat({id:`dynamic_iframe_${Date.now()}`,type:n?"malicious_url":"suspicious_script",level:n?"high":"medium",url:window.location.href,description:n?`æ£€æµ‹åˆ°æ¶æ„iframe: ${new URL(e).hostname}`:`åŠ¨æ€æ·»åŠ å¤–éƒ¨iframe: ${new URL(e).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:e}})}}checkIfMaliciousUrl(t){try{const e=new URL(t).hostname.toLowerCase();return[/malware.*example/i,/phishing.*test/i,/suspicious.*site/i,/fake.*bank/i,/scam.*lottery/i,/evil.*domain/i,/exploit.*kit/i,/malware/i,/virus/i,/trojan/i,/ransomware/i,/spyware/i,/paypal.*verify/i,/paypal.*secure/i,/amazon.*verify/i,/google.*verify/i,/microsoft.*update/i,/bitcoin.*doubler/i,/free.*money/i,/win.*prize/i].some(i=>i.test(e))}catch{return!1}}analyzeFormElement(t){const e=t.action;if(e&&e!==window.location.href)try{const n=new URL(e),i=new URL(window.location.href);n.hostname!==i.hostname&&this.reportThreat({id:`dynamic_cross_domain_form_${Date.now()}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`åŠ¨æ€æ·»åŠ è·¨åŸŸè¡¨å•: ${n.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:e}})}catch{}}isDangerousAttribute(t,e){return t.startsWith("on")||(t==="src"||t==="href")&&e.startsWith("javascript:")?!0:p(e).detected}isTrustedDomain(t){try{const e=new URL(t).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","cdn.jsdelivr.net","unpkg.com","jsdelivr.net","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","gstatic.com","googleusercontent.com","cloudflare.com","cloudflareinsights.com","cloudfront.net"].some(i=>e===i||e.endsWith("."+i))}catch{return!1}}reportThreat(t){this.settings&&!this.settings.enabled||this.settings&&!(()=>{switch(t.type){case"malicious_url":return this.settings.maliciousUrlProtection;case"xss_attack":return this.settings.xssProtection;case"suspicious_script":return this.settings.xssProtection;case"insecure_form":return this.settings.formProtection;default:return!0}})()||this.threatCallback&&this.threatCallback(t)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null)}}class F{formListeners=new Map;threatCallback;initialize(){console.log("ğŸ“ Form Monitor initialized"),this.setupFormMonitoring()}setThreatCallback(t){this.threatCallback=t}setupFormMonitoring(){document.addEventListener("submit",e=>{e.target instanceof HTMLFormElement&&this.onFormSubmit(e)},!0),new MutationObserver(e=>{e.forEach(n=>{n.addedNodes.forEach(i=>{i instanceof HTMLFormElement?this.monitorForm(i):i instanceof HTMLElement&&i.querySelectorAll("form").forEach(s=>this.monitorForm(s))})})}).observe(document.body,{childList:!0,subtree:!0})}monitorForm(t){if(this.formListeners.has(t))return;const e=n=>{this.onFormSubmit(n)};t.addEventListener("submit",e,!0),this.formListeners.set(t,e)}onFormSubmit(t){const e=t.target,n=this.analyzeFormSubmit(e);if(n.length===0)return;n.some(s=>s.level===c.CRITICAL||s.level===c.HIGH)&&(t.preventDefault(),this.showWarning(n),this.reportThreats(n))}showWarning(t){const e=t.map(n=>`â€¢ ${n.description}`).join(`
`);console.warn(`âš ï¸ æ£€æµ‹åˆ°å®‰å…¨å¨èƒï¼š

${e}

ä¸ºäº†æ‚¨çš„å®‰å…¨ï¼Œè¡¨å•æäº¤å·²è¢«é˜»æ­¢ã€‚`)}reportThreats(t){typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threats:t}).catch(e=>console.error("Failed to report threats:",e)),this.emitThreats(t)}emitThreats(t){this.threatCallback&&t.forEach(e=>this.threatCallback?.(e))}async scanForms(){const t=[];return document.querySelectorAll("form").forEach((n,i)=>{const s=this.analyzeForm(n,i);t.push(...s)}),t}async checkFormSecurity(t){return R(t)}analyzeFormSubmit(t){const e=[],n=new FormData(t);for(const[i,s]of n.entries()){if(typeof s!="string")continue;const r=U(s);r.detected&&r.patterns.forEach(u=>{e.push({id:`sql_injection_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.SQL_INJECTION,level:u.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${i}" åŒ…å«SQLæ³¨å…¥æ”»å‡»: ${u.description}`,timestamp:Date.now(),blocked:!0,details:{field:i,value:s.substring(0,100),pattern:u.id}})});const l=p(s);l.detected&&l.patterns.forEach(u=>{e.push({id:`xss_form_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.XSS_ATTACK,level:u.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${i}" åŒ…å«XSSæ”»å‡»: ${u.description}`,timestamp:Date.now(),blocked:!0,details:{field:i,value:s.substring(0,100),pattern:u.id}})});const h=$(s);h.detected&&!t.action.startsWith("https://")&&e.push({id:`sensitive_data_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.INSECURE_FORM,level:c.HIGH,url:window.location.href,description:`è¡¨å•åœ¨éHTTPSè¿æ¥ä¸‹ä¼ è¾“æ•æ„Ÿä¿¡æ¯: ${h.types.join(", ")}`,timestamp:Date.now(),blocked:!0,details:{field:i,types:h.types}})}return e}analyzeForm(t,e){const n=[],i=t.action||window.location.href,s=t.method.toLowerCase();if(s==="post"&&!i.startsWith("https://")){const r=t.querySelector('input[type="password"]'),l=this.hasSensitiveFields(t);(r||l)&&n.push({id:`insecure_form_${Date.now()}_${e}`,type:a.INSECURE_FORM,level:c.HIGH,url:window.location.href,description:"è¡¨å•åŒ…å«æ•æ„Ÿä¿¡æ¯ä½†æœªä½¿ç”¨HTTPSæäº¤",timestamp:Date.now(),blocked:!1,details:{action:i,method:s,hasPassword:!!r,hasSensitiveFields:l}})}if(i&&i!==window.location.href)try{const r=new URL(i),l=new URL(window.location.href);r.hostname!==l.hostname&&n.push({id:`cross_domain_form_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:c.MEDIUM,url:window.location.href,description:`è¡¨å•æäº¤åˆ°å¤–éƒ¨åŸŸå: ${r.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:i,targetDomain:r.hostname}})}catch{n.push({id:`invalid_form_action_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:c.MEDIUM,url:window.location.href,description:"è¡¨å•actionåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{action:i}})}return n}hasSensitiveFields(t){const e=t.querySelectorAll("input, textarea"),n=[/password/i,/credit.*card/i,/social.*security/i,/ssn/i,/é“¶è¡Œå¡/i,/å¯†ç /i,/èº«ä»½è¯/i,/phone/i,/email/i,/address/i];for(const i of e){const s=i,r=`${s.name} ${s.placeholder} ${s.id}`.toLowerCase();if(n.some(l=>l.test(r))||s instanceof HTMLInputElement&&["password","email","tel"].includes(s.type))return!0}return!1}}class H{suspiciousPatterns=[/eval\s*\(/gi,/document\.write\s*\(/gi,/innerHTML\s*=.*<script/gi,/location\.href\s*=/gi,/window\.open\s*\(/gi,/document\.cookie/gi,/localStorage\./gi,/sessionStorage\./gi];threatCallback;initialize(){console.log("ğŸ“œ Script Monitor initialized"),this.setupRealTimeMonitoring(),this.interceptDangerousFunctions()}setThreatCallback(t){this.threatCallback=t}setupRealTimeMonitoring(){new MutationObserver(e=>{e.forEach(n=>{n.addedNodes.forEach(i=>{i.nodeName==="SCRIPT"&&this.handleDynamicScript(i)})})}).observe(document.documentElement,{childList:!0,subtree:!0})}handleDynamicScript(t){t.src?this.analyzeExternalScript(t,0).forEach(e=>{this.reportThreat(e)}):t.textContent&&this.analyzeInlineScript(t,0).forEach(e=>{this.reportThreat(e)})}interceptDangerousFunctions(){try{const t=document.createElement("script");t.textContent=`
      (function() {
        // ä¿å­˜åŸå§‹å‡½æ•°
        const originalEval = window.eval;
        const originalFunction = window.Function;
        const originalSetTimeout = window.setTimeout;
        const originalSetInterval = window.setInterval;
        
        // æ‹¦æˆªeval
        window.eval = function(...args) {
          console.warn('ğŸš¨ eval() è¢«è°ƒç”¨:', args[0]?.substring(0, 100));
          window.postMessage({
            type: 'WEB_SEC_GUARDIAN_ALERT',
            function: 'eval',
            args: args[0]?.substring(0, 200),
            stack: new Error().stack
          }, '*');
          return originalEval.apply(this, args);
        };
        
        // æ‹¦æˆªFunctionæ„é€ å‡½æ•°
        window.Function = new Proxy(originalFunction, {
          construct(target, args) {
            console.warn('ğŸš¨ Function() è¢«è°ƒç”¨:', args);
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'Function',
              args: JSON.stringify(args).substring(0, 200),
              stack: new Error().stack
            }, '*');
            return new target(...args);
          }
        });
        
        // æ‹¦æˆªsetTimeoutä¸­çš„å­—ç¬¦ä¸²
        window.setTimeout = function(handler, ...args) {
          if (typeof handler === 'string') {
            console.warn('ğŸš¨ setTimeoutæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'setTimeout',
              args: handler.substring(0, 200)
            }, '*');
          }
          return originalSetTimeout.call(this, handler, ...args);
        };
        
        // æ‹¦æˆªsetIntervalä¸­çš„å­—ç¬¦ä¸²
        window.setInterval = function(handler, ...args) {
          if (typeof handler === 'string') {
            console.warn('ğŸš¨ setIntervalæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'setInterval',
              args: handler.substring(0, 200)
            }, '*');
          }
          return originalSetInterval.call(this, handler, ...args);
        };
        
        console.log('ğŸ›¡ï¸ Web Security Guardian - å±é™©å‡½æ•°ç›‘æ§å·²æ¿€æ´»');
      })();
    `,(document.head||document.documentElement).insertBefore(t,(document.head||document.documentElement).firstChild),t.remove()}catch{}window.addEventListener("message",t=>{if(t.source===window&&t.data.type==="WEB_SEC_GUARDIAN_ALERT"){const e={id:`dangerous_function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.XSS_ATTACK,level:c.HIGH,url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å‡½æ•°è°ƒç”¨: ${t.data.function}()`,timestamp:Date.now(),blocked:!1,details:{function:t.data.function,args:t.data.args,stack:t.data.stack}};this.reportThreat(e)}})}reportThreat(t){this.threatCallback&&this.threatCallback(t),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:t}).catch(e=>console.error("Failed to report threat:",e))}async scanScripts(){const t=[];return document.querySelectorAll("script:not([src])").forEach((i,s)=>{const r=this.analyzeInlineScript(i,s);t.push(...r)}),document.querySelectorAll("script[src]").forEach((i,s)=>{const r=this.analyzeExternalScript(i,s);t.push(...r)}),t}analyzeInlineScript(t,e){const n=[],i=t.textContent||t.innerHTML||"";if(!i.trim())return n;const s=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.startsWith("192.168.");return s&&t.hasAttribute("type")&&t.getAttribute("type")==="module"||(s||this.suspiciousPatterns.forEach((r,l)=>{const h=i.match(r);h&&n.push({id:`suspicious_inline_script_${Date.now()}_${e}_${l}`,type:a.SUSPICIOUS_SCRIPT,level:this.getPatternSeverity(r),url:window.location.href,description:`å†…è”è„šæœ¬åŒ…å«å¯ç–‘ä»£ç : ${this.getPatternDescription(r)}`,timestamp:Date.now(),blocked:!1,details:{pattern:r.toString(),matches:h.slice(0,3),scriptContent:i.substring(0,200)}})}),i.length>1e4&&this.isObfuscated(i)&&n.push({id:`obfuscated_script_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:c.MEDIUM,url:window.location.href,description:"æ£€æµ‹åˆ°å¯èƒ½çš„æ··æ·†è„šæœ¬ä»£ç ",timestamp:Date.now(),blocked:!1,details:{scriptLength:i.length,scriptPreview:i.substring(0,100)}})),n}analyzeExternalScript(t,e){const n=[],i=t.src;if(!i)return n;try{const s=new URL(i);this.isTrustedDomain(s.hostname)||n.push({id:`untrusted_external_script_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:c.MEDIUM,url:window.location.href,description:`åŠ è½½æ¥è‡ªä¸å¯ä¿¡åŸŸåçš„è„šæœ¬: ${s.hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i,domain:s.hostname}}),s.protocol==="http:"&&window.location.protocol==="https:"&&n.push({id:`mixed_content_script_${Date.now()}_${e}`,type:a.INSECURE_FORM,level:c.MEDIUM,url:window.location.href,description:"HTTPSé¡µé¢åŠ è½½HTTPè„šæœ¬ï¼ˆæ··åˆå†…å®¹ï¼‰",timestamp:Date.now(),blocked:!1,details:{src:i}})}catch{n.push({id:`invalid_script_src_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:c.HIGH,url:window.location.href,description:"è„šæœ¬srcåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{src:i}})}return n}getPatternSeverity(t){const e=t.toString();return e.includes("eval")?c.HIGH:e.includes("document.write")?c.MEDIUM:e.includes("innerHTML.*<script")?c.HIGH:e.includes("location.href")?c.MEDIUM:e.includes("document.cookie")?c.MEDIUM:c.LOW}getPatternDescription(t){const e=t.toString();return e.includes("eval")?"eval()å‡½æ•°è°ƒç”¨":e.includes("document.write")?"document.write()è°ƒç”¨":e.includes("innerHTML.*<script")?"innerHTMLæ³¨å…¥è„šæœ¬":e.includes("location.href")?"é¡µé¢é‡å®šå‘":e.includes("document.cookie")?"Cookieè®¿é—®":e.includes("localStorage")?"localStorageè®¿é—®":e.includes("sessionStorage")?"sessionStorageè®¿é—®":"å¯ç–‘ä»£ç æ¨¡å¼"}isObfuscated(t){return[/[a-zA-Z_$][a-zA-Z0-9_$]*\s*=\s*['"]\w+['"]/.test(t),t.split(`
`).length<10&&t.length>5e3,/\\x[0-9a-fA-F]{2}/.test(t),/\\u[0-9a-fA-F]{4}/.test(t),(t.match(/[{}]/g)||[]).length>t.length*.1].filter(Boolean).length>=2}isTrustedDomain(t){return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net","stackpath.bootstrapcdn.com","maxcdn.bootstrapcdn.com","fonts.googleapis.com","use.fontawesome.com","cdn.jsdelivr.net","unpkg.com","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","youtube.com","ytimg.com","googlevideo.com","gstatic.com","ggpht.com","googleusercontent.com","recaptcha.net","cloudflare.com","cloudflareinsights.com","akamaized.net","fastly.net","amazonaws.com","s3.amazonaws.com","cloudfront.net"].some(n=>t===n||t.endsWith("."+n))}}class O{threats=[];initialize(){console.log("ğŸ“Š Page Analyzer initialized")}async scanPage(){return this.threats=[],await this.scanContent(),await this.scanExternalResources(),await this.scanUrl(),this.threats}async analyzePage(){const t=await this.scanPage(),e=A(t);return{url:window.location.href,score:e,threats:t,recommendations:this.generateRecommendations(t),scanTime:Date.now(),isSecure:t.length===0}}async scanContent(){const t=document.documentElement.innerHTML,e=p(t);e.detected&&e.patterns.forEach(n=>{this.threats.push({id:`xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:n.severity,url:window.location.href,description:`æ£€æµ‹åˆ°XSSæ¨¡å¼: ${n.description}`,timestamp:Date.now(),blocked:!1,details:{pattern:n.id}})})}async scanExternalResources(){document.querySelectorAll("script[src]").forEach(n=>{const i=n.src;i&&!this.isTrustedDomain(i)&&this.threats.push({id:`external_script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨è„šæœ¬: ${new URL(i).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i}})}),document.querySelectorAll("iframe[src]").forEach(n=>{const i=n.src;i&&!this.isTrustedDomain(i)&&this.threats.push({id:`external_iframe_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨iframe: ${new URL(i).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i}})})}async scanUrl(){const t=window.location.href;!t.startsWith("https://")&&!t.startsWith("file://")&&this.threats.push({id:`insecure_protocol_${Date.now()}`,type:"insecure_form",level:"medium",url:t,description:"ç½‘ç«™æœªä½¿ç”¨HTTPSåŠ å¯†è¿æ¥",timestamp:Date.now(),blocked:!1})}isTrustedDomain(t){try{const e=new URL(t).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net","cdn.jsdelivr.net","twimg.com","abs.twimg.com","pbs.twimg.com","ton.twimg.com","facebook.net","fbcdn.net","gstatic.com","googleusercontent.com","cloudflare.com","cloudflareinsights.com","cloudfront.net"].some(i=>e===i||e.endsWith("."+i))}catch{return!1}}generateRecommendations(t){const e=[],n=new Set(t.map(i=>i.type));return n.has("xss_attack")&&e.push("æ£€æµ‹åˆ°XSSé£é™©ï¼Œå»ºè®®æ›´æ–°æµè§ˆå™¨å¹¶å¯ç”¨å®‰å…¨é˜²æŠ¤"),n.has("suspicious_script")&&e.push("å‘ç°å¯ç–‘å¤–éƒ¨èµ„æºï¼Œè¯·ç¡®è®¤ç½‘ç«™å¯ä¿¡åº¦"),n.has("insecure_form")&&e.push("ç½‘ç«™æœªä½¿ç”¨HTTPSï¼Œé¿å…è¾“å…¥æ•æ„Ÿä¿¡æ¯"),e.length===0&&e.push("é¡µé¢å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼Œä½†ä»éœ€ä¿æŒè­¦æƒ•"),e}}console.log("ğŸ›¡ï¸ Web Security Guardian å†…å®¹è„šæœ¬å¯åŠ¨:",window.location.href);const w=new P,v=new F,k=new H,N=new O,T=new Set,b=[];let y=!1,x=null,m=!1,g=!1,C=!1,d={enabled:!0,maliciousUrlProtection:!0,xssProtection:!0,trackerBlocking:!0,formProtection:!0,phishingProtection:!0,notifications:!0,autoUpdate:!0,strictMode:!1};chrome.storage.local.get(["protection_settings"],o=>{o.protection_settings&&(d={...d,...o.protection_settings},console.log("âœ… Content script settings loaded:",d))});chrome.storage.onChanged.addListener((o,t)=>{t==="local"&&o.protection_settings&&(d=o.protection_settings.newValue,console.log("âš™ï¸ Content script settings updated:",d),w.setSettings(d))});async function W(){try{const o=window.location.hostname,t=await chrome.storage.local.get(["whitelist"]);let e=[];return t.whitelist&&Array.isArray(t.whitelist)&&(e=t.whitelist),console.log("ğŸ” ç™½åå•æ£€æŸ¥:",{å½“å‰åŸŸå:o,ç™½åå•æ•°é‡:e.length}),e.length===0?(m=!1,!1):(m=e.some(n=>o===n||o.endsWith(`.${n}`)),m&&(console.log("âœ… å½“å‰ç½‘ç«™åœ¨ç™½åå•ä¸­ï¼Œå·²ç¦ç”¨æ‰€æœ‰å®‰å…¨æ£€æµ‹"),B()),m)}catch(o){return console.error("âŒ æ£€æŸ¥ç™½åå•å¤±è´¥:",o),m=!1,!1}}function B(){if(!document.body)return;const o=document.createElement("div");o.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:32px 40px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:2147483647;text-align:center;min-width:400px",o.innerHTML='<div style="font-size:48px;margin-bottom:16px">âœ…</div><h2 style="margin:0 0 12px;font-size:24px;font-weight:700">ç™½åå•ç½‘ç«™</h2><p style="margin:0 0 24px;font-size:14px;opacity:0.8">å½“å‰ç½‘ç«™å·²åŠ å…¥ç™½åå•<br>æ‰€æœ‰å®‰å…¨æ£€æµ‹åŠŸèƒ½å·²ç¦ç”¨</p><button onclick="this.parentElement.remove()" style="background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.4);color:white;padding:12px 32px;border-radius:8px;font-size:14px;cursor:pointer">æˆ‘çŸ¥é“äº†</button>';const t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:2147483646",t.onclick=()=>{o.remove(),t.remove()},document.body.appendChild(t),document.body.appendChild(o),setTimeout(()=>{o.parentElement&&(o.remove(),t.remove())},3e3)}async function j(){try{const o=window.location.hostname,t=await chrome.storage.local.get(["blacklist"]);let e=[];return t.blacklist&&Array.isArray(t.blacklist)&&(e=t.blacklist),console.log("ğŸ” é»‘åå•æ£€æŸ¥:",{å½“å‰åŸŸå:o,é»‘åå•æ•°é‡:e.length}),e.length===0?(g=!1,!1):(g=e.some(n=>o===n||o.endsWith(`.${n}`)),g?(console.log("âš ï¸ å½“å‰ç½‘ç«™åœ¨é»‘åå•ä¸­ï¼Œæ˜¾ç¤ºè­¦å‘Šå¼¹çª—"),!0):!1)}catch(o){return console.error("âŒ æ£€æŸ¥é»‘åå•å¤±è´¥:",o),g=!1,!1}}function G(){return new Promise(o=>{if(!document.body){o(!1);return}const t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:2147483646;backdrop-filter:blur(10px)";const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#ff416c,#ff4b2b);color:white;padding:48px;border-radius:24px;box-shadow:0 30px 90px rgba(255,65,108,0.5);z-index:2147483647;text-align:center;width:550px;max-width:90vw;animation:warningPulse 2s ease-in-out infinite";const n=document.createElement("style");n.textContent=`
      @keyframes warningPulse {
        0%, 100% { box-shadow: 0 30px 90px rgba(255,65,108,0.5); }
        50% { box-shadow: 0 30px 90px rgba(255,65,108,0.8), 0 0 40px rgba(255,65,108,0.6); }
      }
    `,document.head.appendChild(n),e.innerHTML=`
      <div style="font-size:72px;margin-bottom:20px;animation:shake 0.5s ease-in-out infinite">âš ï¸</div>
      <h2 style="margin:0 0 16px;font-size:32px;font-weight:900;text-shadow:2px 2px 4px rgba(0,0,0,0.3)">å±é™©ç½‘ç«™è­¦å‘Š</h2>
      <p style="margin:0 0 32px;font-size:16px;opacity:0.95;line-height:1.6">
        å½“å‰ç½‘ç«™å·²è¢«åˆ—å…¥é»‘åå•<br>
        <strong style="font-size:18px">å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©æˆ–æ¶æ„å†…å®¹</strong><br>
        <span style="font-size:14px;opacity:0.8">å»ºè®®æ‚¨ç«‹å³ç¦»å¼€æ­¤ç½‘ç«™</span>
      </p>
      <div style="display:flex;gap:16px;justify-content:center">
        <button id="blacklistExit" style="background:rgba(255,255,255,0.95);color:#ff4b2b;padding:16px 40px;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.2)">
          ğŸšª é€€å‡ºç½‘ç«™
        </button>
        <button id="blacklistContinue" style="background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.5);color:white;padding:16px 40px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s">
          âš¡ ç»§ç»­è¿›å…¥
        </button>
      </div>
      <p style="margin:24px 0 0;font-size:12px;opacity:0.6">
        ç½‘ç«™: ${window.location.hostname}
      </p>
    `;const i=document.createElement("style");i.textContent=`
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px) rotate(-5deg); }
        75% { transform: translateX(5px) rotate(5deg); }
      }
    `,document.head.appendChild(i),document.body.appendChild(t),document.body.appendChild(e);const s=document.getElementById("blacklistExit");s&&(s.onmouseover=()=>{s.style.transform="scale(1.05)",s.style.boxShadow="0 6px 20px rgba(0,0,0,0.3)"},s.onmouseout=()=>{s.style.transform="scale(1)",s.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)"},s.onclick=()=>{console.log("ğŸšª ç”¨æˆ·é€‰æ‹©é€€å‡ºé»‘åå•ç½‘ç«™"),e.remove(),t.remove(),n.remove(),i.remove(),window.location.href="about:blank",o(!1)});const r=document.getElementById("blacklistContinue");r&&(r.onmouseover=()=>{r.style.background="rgba(255,255,255,0.25)",r.style.transform="scale(1.05)"},r.onmouseout=()=>{r.style.background="rgba(255,255,255,0.15)",r.style.transform="scale(1)"},r.onclick=()=>{console.log("âš¡ ç”¨æˆ·é€‰æ‹©ç»§ç»­è¿›å…¥é»‘åå•ç½‘ç«™"),e.remove(),t.remove(),n.remove(),i.remove(),C=!0,o(!0)})})}function D(){return typeof chrome<"u"&&!!chrome.runtime?.sendMessage}function q(o){D()&&(T.has(o.id)||(T.add(o.id),chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:o}).catch(t=>console.error("Failed to notify background:",t))))}function I(o){switch(o){case a.MALICIOUS_URL:return"æ¶æ„ç½‘å€";case a.XSS_ATTACK:return"XSSæ”»å‡»";case a.SQL_INJECTION:return"SQLæ³¨å…¥";case a.TRACKER:return"è¿½è¸ªå™¨";case a.INSECURE_FORM:return"ä¸å®‰å…¨ä¼ è¾“";case a.SUSPICIOUS_SCRIPT:return"å¯ç–‘è„šæœ¬";case a.PHISHING:return"é’“é±¼é£é™©";case a.DATA_LEAK:return"æ•æ„Ÿä¿¡æ¯æ³„éœ²";default:return"å®‰å…¨è­¦å‘Š"}}function X(o){switch(o){case c.CRITICAL:return"linear-gradient(135deg, #ff1744, #b71c1c)";case c.HIGH:return"linear-gradient(135deg, #ff6b6b, #d32f2f)";case c.MEDIUM:return"linear-gradient(135deg, #ffb74d, #f57c00)";case c.LOW:return"linear-gradient(135deg, #66bb6a, #2e7d32)";default:return"linear-gradient(135deg, #607d8b, #455a64)"}}function M(o){if(!document.body){b.push(o);return}let t=o.url;try{t=new URL(o.url).hostname}catch{}const e="wsg-threat-container";let n=document.getElementById(e);n||(n=document.createElement("div"),n.id=e,n.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 2147483647;
      max-width: 380px;
      pointer-events: none;
    `,document.body.appendChild(n));const i=document.createElement("div");i.style.cssText=`
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 18px 20px;
    border-radius: 16px;
    color: #fff;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
    background: ${X(o.level)};
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    pointer-events: auto;
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateX(400px) scale(0.9);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    backdrop-filter: blur(10px);
  `;const s=document.createElement("div");if(s.style.cssText=`
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 3s infinite;
  `,i.appendChild(s),i.innerHTML+=`
    <div style="font-size: 24px; line-height: 1; animation: bounce 0.6s ease;">ğŸ›¡ï¸</div>
    <div style="flex: 1; min-width: 0;">
      <div style="font-weight: 700; font-size: 14px; margin-bottom: 6px; letter-spacing: 0.3px;">
        ${I(o.type)} Â· ${o.level.toUpperCase()}
      </div>
      <div style="font-size: 13px; word-break: break-word; line-height: 1.6; opacity: 0.95;">${o.description}</div>
      <div style="margin-top: 8px; font-size: 11px; opacity: 0.8; font-weight: 500;">
        ğŸ“ ${t}
      </div>
    </div>
    <button type="button" aria-label="å…³é—­è­¦å‘Š"
      style="background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 20px; cursor: pointer; line-height: 1; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;">Ã—</button>
  `,!document.getElementById("wsg-toast-animations")){const l=document.createElement("style");l.id="wsg-toast-animations",l.textContent=`
      @keyframes shine {
        0% { left: -100%; }
        50% { left: 100%; }
        100% { left: 100%; }
      }
      @keyframes bounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
      }
    `,document.head.appendChild(l)}const r=i.querySelector("button");r?.addEventListener("mouseenter",()=>{r instanceof HTMLElement&&(r.style.background="rgba(255,255,255,0.3)",r.style.transform="scale(1.1)")}),r?.addEventListener("mouseleave",()=>{r instanceof HTMLElement&&(r.style.background="rgba(255,255,255,0.2)",r.style.transform="scale(1)")}),r?.addEventListener("click",l=>{l.stopPropagation(),i.style.opacity="0",i.style.transform="translateX(400px) scale(0.8)",setTimeout(()=>i.remove(),400)}),n.appendChild(i),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateX(0) scale(1)"})}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(400px) scale(0.8)",setTimeout(()=>i.remove(),400)},6e3)}function K(){if(!b.length)return;const o=[...b];b.length=0,o.forEach(M)}function f(o,t={}){if(!d.enabled){console.log("â¸ï¸ Protection disabled, threat ignored");return}if(m)return;if(!(()=>{switch(o.type){case a.MALICIOUS_URL:return d.maliciousUrlProtection;case a.XSS_ATTACK:return d.xssProtection;case a.TRACKER:return d.trackerBlocking;case a.INSECURE_FORM:return d.formProtection;case a.PHISHING:return d.phishingProtection;case a.SUSPICIOUS_SCRIPT:return d.xssProtection;default:return!0}})()){console.log(`â­ï¸ Threat type ${o.type} protection is disabled`);return}console.warn("ğŸš¨ å¨èƒæ£€æµ‹:",{ç±»å‹:I(o.type),ç­‰çº§:o.level.toUpperCase(),æè¿°:o.description,è¯¦æƒ…:o.details}),d.notifications&&M(o),t.notifyBackground&&q(o)}const S=document.createElement("meta");S.name="web-security-guardian";S.content="active";document.head?.appendChild(S);window.webSecurityGuardian={version:"1.0.0",isActive:!0,reportThreat:o=>{const t={id:o.id||E(),type:o.type||a.DATA_LEAK,level:o.level||c.MEDIUM,url:o.url||window.location.href,description:o.description||"æ£€æµ‹åˆ°æœªçŸ¥å®‰å…¨å¨èƒ",timestamp:o.timestamp||Date.now(),blocked:o.blocked??!1,details:o.details};f(t,{notifyBackground:!0})}};function L(o,t){if(!d.enabled||!d.phishingProtection)return!1;try{const e=new URL(o,window.location.href).href,n=z(e);if(n.detected){const i={id:E(),type:a.PHISHING,level:n.score>=80?c.CRITICAL:c.HIGH,url:e,description:`æ£€æµ‹åˆ°ç–‘ä¼¼é’“é±¼é“¾æ¥ï¼ˆæ¥æºï¼š${t}ï¼‰`,timestamp:Date.now(),blocked:!0,details:{reasons:n.reasons,score:n.score,source:t}};return f(i,{notifyBackground:!0}),console.warn("ğŸ£ é’“é±¼é£é™©è¯¦æƒ…:",n.reasons),!0}}catch(e){console.warn("æ— æ³•è§£æURLè¿›è¡Œå®‰å…¨æ£€æŸ¥:",o,e)}return!1}function Q(){document.addEventListener("click",o=>{if(!(o.target instanceof Element))return;const t=o.target.closest("a[href]");if(!t)return;const e=t.href;L(e,"anchor_click")&&(o.preventDefault(),o.stopImmediatePropagation())},!0)}function J(){const o=window.open;window.open=function(...t){const e=t[0],n=typeof e=="string"?e:e?.toString?.();return typeof n=="string"&&L(n,"window.open")?null:o.apply(window,t)}}async function _(){if(K(),await W()){console.log("â¸ï¸ ç™½åå•ç½‘ç«™ï¼Œå·²ç¦ç”¨æ‰€æœ‰å®‰å…¨æ£€æµ‹");return}if(await j()&&!C){if(console.log("âš ï¸ é»‘åå•ç½‘ç«™ï¼Œæ˜¾ç¤ºè­¦å‘Šå¼¹çª—"),!await G()){console.log("ğŸš« ç”¨æˆ·æ‹’ç»è¿›å…¥é»‘åå•ç½‘ç«™");return}console.log("âœ… ç”¨æˆ·é€‰æ‹©ç»§ç»­è¿›å…¥é»‘åå•ç½‘ç«™")}D()&&chrome.runtime.sendMessage({type:"PAGE_NAVIGATION",url:window.location.href}).then(s=>{s?.clearedCount>0&&console.log(`ğŸ—‘ï¸ å·²æ¸…é™¤ ${s.clearedCount} æ¡å†å²å¨èƒï¼Œå¼€å§‹é‡æ–°è¯„ä¼°`)}).catch(s=>console.error("Failed to notify page navigation:",s));let e=!1;function n(){e||(e=!0,w.setThreatCallback(s=>f(s,{notifyBackground:!0})),w.setSettings(d),w.initialize(),v.setThreatCallback(s=>f(s,{notifyBackground:!0})),v.initialize(),k.setThreatCallback(s=>f(s,{notifyBackground:!0})),k.initialize(),console.log("âœ… ç›‘æ§å™¨å·²å¯åŠ¨"))}function i(){m||(y||(y=!0,console.log("ğŸ‘† æ£€æµ‹åˆ°ç”¨æˆ·äº¤äº’ï¼Œå¯åŠ¨ç›‘æ§"),n()),x&&clearTimeout(x),x=window.setTimeout(()=>{y=!1,console.log("â¸ï¸ ç”¨æˆ·äº¤äº’è¶…æ—¶ï¼Œæš‚åœç›‘æ§")},5e3))}document.addEventListener("click",i,!0),document.addEventListener("submit",i,!0),document.addEventListener("keydown",s=>{s.key==="Enter"&&i()},!0),N.initialize(),Q(),console.log("âœ… Web Security Guardian å†…å®¹è„šæœ¬å·²æ¿€æ´»ï¼ˆå®æ—¶ç›‘æ§æ¨¡å¼ï¼‰")}J();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_();
