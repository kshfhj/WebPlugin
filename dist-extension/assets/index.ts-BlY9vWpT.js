console.log("ğŸ›¡ï¸ Web Security Guardian Background Service Starting...");class h{maliciousUrls=new Set(["malware-example.com","phishing-test.net","suspicious-site.org","fake-bank.com","scam-lottery.net"]);trackerDomains=new Set(["google-analytics.com","googletagmanager.com","facebook.com","doubleclick.net","googlesyndication.com","amazon-adsystem.com"]);isMalicious(s){try{const e=new URL(s).hostname.toLowerCase();return Array.from(this.maliciousUrls).some(r=>e===r||e.endsWith("."+r))}catch{return!1}}isTracker(s){try{const e=new URL(s).hostname.toLowerCase();return Array.from(this.trackerDomains).some(r=>e===r||e.endsWith("."+r))}catch{return!1}}}const i=new h;chrome.runtime.onInstalled.addListener(t=>{console.log("âœ… Extension installed:",t.reason),t.reason==="install"&&(chrome.storage.local.set({protection_settings:{maliciousUrlProtection:!0,xssProtection:!0,trackerBlocking:!0,formProtection:!0,phishingProtection:!0,notifications:!0,autoUpdate:!0,strictMode:!1},security_stats:{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{malicious_url:0,xss_attack:0,tracker:0,insecure_form:0,suspicious_script:0,phishing:0},threatsByLevel:{low:0,medium:0,high:0,critical:0},lastScanTime:0}}),chrome.tabs.create({url:chrome.runtime.getURL("src/options/index.html")}))});chrome.webRequest.onBeforeRequest.addListener(t=>{i.isMalicious(t.url)&&(console.log("ğŸš« Malicious URL detected (blocked by declarativeNetRequest):",t.url),chrome.storage.local.get(["security_stats"],s=>{if(s.security_stats){const e=s.security_stats;e.totalThreats++,e.blockedThreats++,e.threatsByType.malicious_url++,e.threatsByLevel.high++,chrome.storage.local.set({security_stats:e})}})),i.isTracker(t.url)&&(console.log("ğŸ‘ï¸ Tracker request detected (blocked by declarativeNetRequest):",t.url),chrome.storage.local.get(["security_stats"],s=>{if(s.security_stats){const e=s.security_stats;e.totalThreats++,e.blockedThreats++,e.threatsByType.tracker++,e.threatsByLevel.medium++,chrome.storage.local.set({security_stats:e})}}))},{urls:["<all_urls>"]});chrome.runtime.onMessage.addListener((t,s,e)=>{console.log("ğŸ“¨ Received message:",t.type);try{switch(t.type){case"GET_SECURITY_STATUS":return chrome.storage.local.get(["security_stats"],o=>{e({maliciousUrlsCount:o.security_stats?.blockedThreats||0,trackersBlocked:o.security_stats?.threatsByType?.tracker||0})}),!0;case"GET_STATS":return chrome.storage.local.get(["security_stats"],o=>{e(o.security_stats||{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{},threatsByLevel:{},lastScanTime:Date.now()})}),!0;case"UPDATE_SETTINGS":return chrome.storage.local.set({protection_settings:t.data},()=>{e({success:!0})}),!0;case"SETTINGS_UPDATED":console.log("âš™ï¸ Settings updated:",t.data),e({success:!0});break;case"TOGGLE_PROTECTION":console.log("ğŸ”„ Protection toggled:",t.data),e({success:!0});break;case"SCAN_PAGE":console.log("ğŸ” Scanning page:",t.data?.tabId),e({success:!0});break;case"PAGE_NAVIGATION":console.log("ğŸ”„ Page navigation detected, clearing previous threats for:",t.url);let r="";try{r=new URL(t.url).hostname}catch{r=t.url}return chrome.storage.local.get(["threat_history"],o=>{const a=o.threat_history||[],c=a.filter(n=>{try{return new URL(n.url).hostname!==r}catch{return!n.url.includes(r)}});console.log(`ğŸ—‘ï¸ Cleared ${a.length-c.length} threats for ${r}`),chrome.storage.local.set({threat_history:c},()=>{e({success:!0,clearedCount:a.length-c.length})})}),!0;case"THREAT_DETECTED":console.log("ğŸš¨ Threat detected:",t.threat||t.data);const l=t.threat||t.data;chrome.storage.local.get(["security_stats","threat_history"],o=>{const a=o.security_stats||{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{malicious_url:0,xss_attack:0,sql_injection:0,tracker:0,insecure_form:0,suspicious_script:0,phishing:0,data_leak:0},threatsByLevel:{low:0,medium:0,high:0,critical:0},lastScanTime:Date.now()};a.totalThreats++,l.blocked?a.blockedThreats++:a.allowedThreats++,a.threatsByType[l.type]!==void 0&&a.threatsByType[l.type]++,a.threatsByLevel[l.level]!==void 0&&a.threatsByLevel[l.level]++,a.lastScanTime=Date.now();const c=o.threat_history||[];c.unshift(l),c.length>100&&c.splice(100),chrome.storage.local.set({security_stats:a,threat_history:c}),console.log("ğŸ“Š Stats updated:",a)}),e({success:!0});break;case"SECURITY_ISSUE":console.log("âš ï¸ Security issue:",t.issueType,t.data),e({success:!0});break;default:e({success:!0})}}catch(r){console.error("âŒ Error handling message:",r),e({error:String(r)})}return!0});chrome.tabs.onUpdated.addListener((t,s,e)=>{s.status==="complete"&&e.url&&(console.log("ğŸ“„ Page loaded:",e.url),i.isMalicious(e.url)&&console.log("âš ï¸ Warning: Potentially malicious page"))});chrome.webRequest.onHeadersReceived.addListener(t=>{console.log("ğŸ” Headers received from:",t.url)},{urls:["<all_urls>"]});console.log("âœ… Web Security Guardian Background Service Started Successfully");let u=0;setInterval(()=>{u++,console.log(`ğŸ’“ Service Worker heartbeat #${u}`)},3e4);
