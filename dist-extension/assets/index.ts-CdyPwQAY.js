console.log("ğŸ›¡ï¸ Web Security Guardian Background Service Starting...");class l{maliciousUrls=new Set(["malware-example.com","phishing-test.net","suspicious-site.org","fake-bank.com","scam-lottery.net"]);trackerDomains=new Set(["google-analytics.com","googletagmanager.com","facebook.com","doubleclick.net","googlesyndication.com","amazon-adsystem.com"]);isMalicious(a){try{const e=new URL(a).hostname.toLowerCase();return Array.from(this.maliciousUrls).some(r=>e===r||e.endsWith("."+r))}catch{return!1}}isTracker(a){try{const e=new URL(a).hostname.toLowerCase();return Array.from(this.trackerDomains).some(r=>e===r||e.endsWith("."+r))}catch{return!1}}}const o=new l;chrome.runtime.onInstalled.addListener(t=>{console.log("âœ… Extension installed:",t.reason),t.reason==="install"&&(chrome.storage.local.set({protectionSettings:{maliciousUrlProtection:!0,xssProtection:!0,trackerBlocking:!0,formProtection:!0,phishingProtection:!0,notifications:!0,autoUpdate:!0,strictMode:!1},securityStats:{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{malicious_url:0,xss_attack:0,tracker:0,insecure_form:0,suspicious_script:0,phishing:0},threatsByLevel:{low:0,medium:0,high:0,critical:0},lastScanTime:0}}),chrome.tabs.create({url:chrome.runtime.getURL("src/options/index.html")}))});chrome.webRequest.onBeforeRequest.addListener(t=>{o.isMalicious(t.url)&&(console.log("ğŸš« Malicious URL detected (blocked by declarativeNetRequest):",t.url),chrome.storage.local.get(["securityStats"],a=>{if(a.securityStats){const e=a.securityStats;e.totalThreats++,e.blockedThreats++,e.threatsByType.malicious_url++,e.threatsByLevel.high++,chrome.storage.local.set({securityStats:e})}})),o.isTracker(t.url)&&(console.log("ğŸ‘ï¸ Tracker request detected (blocked by declarativeNetRequest):",t.url),chrome.storage.local.get(["securityStats"],a=>{if(a.securityStats){const e=a.securityStats;e.totalThreats++,e.blockedThreats++,e.threatsByType.tracker++,e.threatsByLevel.medium++,chrome.storage.local.set({securityStats:e})}}))},{urls:["<all_urls>"]});chrome.runtime.onMessage.addListener((t,a,e)=>{console.log("ğŸ“¨ Received message:",t.type);try{switch(t.type){case"GET_SECURITY_STATUS":return chrome.storage.local.get(["securityStats"],r=>{e({maliciousUrlsCount:r.securityStats?.blockedThreats||0,trackersBlocked:r.securityStats?.threatsByType?.tracker||0})}),!0;case"GET_STATS":return chrome.storage.local.get(["securityStats"],r=>{e(r.securityStats||{totalThreats:0,blockedThreats:0,allowedThreats:0,threatsByType:{},threatsByLevel:{},lastScanTime:Date.now()})}),!0;case"UPDATE_SETTINGS":return chrome.storage.local.set({protectionSettings:t.data},()=>{e({success:!0})}),!0;case"SETTINGS_UPDATED":console.log("âš™ï¸ Settings updated:",t.data),e({success:!0});break;case"TOGGLE_PROTECTION":console.log("ğŸ”„ Protection toggled:",t.data),e({success:!0});break;case"SCAN_PAGE":console.log("ğŸ” Scanning page:",t.data?.tabId),e({success:!0});break;case"THREAT_DETECTED":console.log("ğŸš¨ Threat detected:",t.data),chrome.storage.local.get(["recentThreats"],r=>{const s=r.recentThreats||[];s.unshift(t.data),s.length>100&&s.splice(100),chrome.storage.local.set({recentThreats:s})}),e({success:!0});break;case"SECURITY_ISSUE":console.log("âš ï¸ Security issue:",t.issueType,t.data),e({success:!0});break;default:e({success:!0})}}catch(r){console.error("âŒ Error handling message:",r),e({error:String(r)})}return!0});chrome.tabs.onUpdated.addListener((t,a,e)=>{a.status==="complete"&&e.url&&(console.log("ğŸ“„ Page loaded:",e.url),o.isMalicious(e.url)&&console.log("âš ï¸ Warning: Potentially malicious page"))});chrome.webRequest.onHeadersReceived.addListener(t=>{console.log("ğŸ” Headers received from:",t.url)},{urls:["<all_urls>"]});console.log("âœ… Web Security Guardian Background Service Started Successfully");let c=0;setInterval(()=>{c++,console.log(`ğŸ’“ Service Worker heartbeat #${c}`)},3e4);
