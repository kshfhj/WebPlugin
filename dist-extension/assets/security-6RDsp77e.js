var h=(t=>(t.MALICIOUS_URL="malicious_url",t.XSS_ATTACK="xss_attack",t.SQL_INJECTION="sql_injection",t.TRACKER="tracker",t.INSECURE_FORM="insecure_form",t.SUSPICIOUS_SCRIPT="suspicious_script",t.PHISHING="phishing",t.DATA_LEAK="data_leak",t))(h||{}),s=(t=>(t.LOW="low",t.MEDIUM="medium",t.HIGH="high",t.CRITICAL="critical",t))(s||{});const l=[{id:"script_tag",pattern:/<script[^>]*>[\s\S]*?<\/script>/gi,description:"检测到script标签注入",severity:s.HIGH,enabled:!0},{id:"script_src",pattern:/<script[^>]*src\s*=\s*["'][^"']*["'][^>]*>/gi,description:"检测到外部脚本注入",severity:s.HIGH,enabled:!0},{id:"javascript_protocol",pattern:/javascript\s*:/gi,description:"检测到javascript:伪协议",severity:s.HIGH,enabled:!0},{id:"event_handlers",pattern:/on\w+\s*=\s*["'][^"']*["']/gi,description:"检测到内联事件处理器",severity:s.MEDIUM,enabled:!0},{id:"onerror_handler",pattern:/onerror\s*=\s*["'].*["']/gi,description:"检测到onerror事件利用",severity:s.HIGH,enabled:!0},{id:"iframe_injection",pattern:/<iframe[^>]*>/gi,description:"检测到iframe注入",severity:s.HIGH,enabled:!0},{id:"object_embed",pattern:/<(object|embed)[^>]*>/gi,description:"检测到object/embed标签注入",severity:s.MEDIUM,enabled:!0},{id:"eval_function",pattern:/\beval\s*\(/gi,description:"检测到eval函数调用",severity:s.HIGH,enabled:!0},{id:"function_constructor",pattern:/new\s+Function\s*\(/gi,description:"检测到Function构造函数",severity:s.HIGH,enabled:!0},{id:"document_write",pattern:/document\.(write|writeln)\s*\(/gi,description:"检测到document.write调用",severity:s.MEDIUM,enabled:!0},{id:"inner_html",pattern:/\.innerHTML\s*=\s*[^;]+[<>]/gi,description:"检测到innerHTML危险赋值",severity:s.MEDIUM,enabled:!0},{id:"data_uri",pattern:/data:text\/html[^>]*>/gi,description:"检测到data:URI注入",severity:s.HIGH,enabled:!0},{id:"vbscript",pattern:/vbscript:/gi,description:"检测到VBScript协议",severity:s.HIGH,enabled:!0},{id:"svg_script",pattern:/<svg[^>]*>[\s\S]*?<script/gi,description:"检测到SVG中的脚本注入",severity:s.HIGH,enabled:!0},{id:"meta_refresh",pattern:/<meta[^>]*http-equiv\s*=\s*["']refresh["'][^>]*>/gi,description:"检测到meta refresh重定向",severity:s.MEDIUM,enabled:!0},{id:"base_href",pattern:/<base[^>]*href\s*=\s*["'][^"']*["'][^>]*>/gi,description:"检测到base标签劫持",severity:s.MEDIUM,enabled:!0}],f=[{id:"sql_union",pattern:/(\bunion\b.*\bselect\b|\bselect\b.*\bunion\b)/gi,description:"检测到UNION注入攻击",severity:s.HIGH},{id:"sql_or_always_true",pattern:/(\bor\b\s+[\d\w'"]+\s*=\s*[\d\w'"]+|\d+\s*=\s*\d+)/gi,description:"检测到OR恒真条件",severity:s.HIGH},{id:"sql_comment",pattern:/(--|#|\/\*|\*\/)/g,description:"检测到SQL注释符号",severity:s.MEDIUM},{id:"sql_sleep",pattern:/\b(sleep|benchmark|waitfor\s+delay)\b/gi,description:"检测到时间盲注攻击",severity:s.HIGH},{id:"sql_information_schema",pattern:/\binformation_schema\b/gi,description:"检测到数据库元数据查询",severity:s.HIGH},{id:"sql_exec",pattern:/\b(exec|execute|xp_cmdshell)\b/gi,description:"检测到命令执行尝试",severity:s.CRITICAL},{id:"sql_drop",pattern:/\b(drop|delete|truncate|alter)\b\s+\b(table|database)\b/gi,description:"检测到危险SQL操作",severity:s.CRITICAL},{id:"sql_into_outfile",pattern:/\binto\s+(outfile|dumpfile)\b/gi,description:"检测到文件写入尝试",severity:s.HIGH},{id:"sql_load_file",pattern:/\bload_file\s*\(/gi,description:"检测到文件读取尝试",severity:s.HIGH},{id:"sql_quotes",pattern:/['";].*(\bor\b|\band\b).*['";]/gi,description:"检测到引号闭合注入",severity:s.HIGH}];function w(t){const e=[];l.forEach(i=>{i.pattern.global&&(i.pattern.lastIndex=0)});for(const i of l)i.enabled&&i.pattern.test(t)&&(e.push({id:i.id,description:i.description,severity:i.severity}),i.pattern.global&&(i.pattern.lastIndex=0));return{detected:e.length>0,patterns:e}}function S(t){const e=[];let i=t;try{i=decodeURIComponent(t)}catch{}for(const o of f)o.pattern.test(i)&&(e.push({id:o.id,description:o.description,severity:o.severity}),o.pattern.lastIndex=0);const a=/['"`;\\]+/g,n=i.match(a);return n&&n.length>3&&e.push({id:"sql_special_chars",description:"检测到可疑的特殊字符组合",severity:s.MEDIUM}),{detected:e.length>0,patterns:e}}function C(t){if(t.length===0)return 100;let e=100;return t.forEach(i=>{switch(i.level){case s.CRITICAL:e-=30;break;case s.HIGH:e-=20;break;case s.MEDIUM:e-=10;break;case s.LOW:e-=5;break}}),Math.max(0,e)}function b(t){try{return new URL(t).protocol==="https:"}catch{return!1}}function M(t){const e=t.action||window.location.href;return!(t.method.toLowerCase()==="post"&&!b(e)||t.querySelectorAll('input[type="password"], input[name*="password"], input[name*="credit"], input[name*="card"]').length>0&&!b(e))}function U(){return`threat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function L(t){const e=[];let i=0;try{const a=new URL(t),n=a.hostname.toLowerCase(),o=t.toLowerCase(),d=["paypal","amazon","apple","microsoft","google","facebook","instagram","twitter","netflix","ebay","linkedin","alibaba","taobao","alipay","wechat","qq","baidu","jd","bank"];for(const r of d)n.includes(r)&&![`${r}.com`,`${r}.cn`,`${r}.net`,`${r}.org`,`www.${r}.com`,`www.${r}.cn`].includes(n)&&!n.endsWith(`.${r}.com`)&&(e.push(`疑似冒充品牌: ${r}`),i+=40);/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(n)&&(e.push("使用IP地址而非域名"),i+=30);const p=["login","signin","account","verify","secure","update","confirm"],c=n.split(".");c.length>2&&p.forEach(r=>{c[0].includes(r)&&(e.push(`可疑的子域名: ${c[0]}`),i+=20)}),n.length>40&&(e.push("域名过长"),i+=15),(n.match(/\d/g)||[]).length/n.length>.3&&(e.push("域名包含过多数字"),i+=20),(n.match(/-/g)||[]).length>3&&(e.push("域名包含过多连字符"),i+=15),(/[а-яА-Я]/.test(n)||/[α-ωΑ-Ω]/.test(n))&&(e.push("检测到非拉丁字符（可能的同形异义字攻击）"),i+=50),[".tk",".ml",".ga",".cf",".gq",".xyz",".top",".win",".bid"].some(r=>n.endsWith(r))&&(e.push("使用可疑的顶级域名"),i+=25),o.includes("@")&&(e.push("URL包含@符号（可能的用户名欺骗）"),i+=30),(n.match(/\./g)||[]).length>4&&(e.push("域名层级过深"),i+=20),a.port&&a.port!=="80"&&a.port!=="443"&&(e.push(`使用非标准端口: ${a.port}`),i+=10);const u=["verify","account","update","confirm","secure","banking","suspended"].filter(r=>o.includes(r));return u.length>=2&&(e.push(`URL包含多个可疑关键词: ${u.join(", ")}`),i+=25),{detected:i>=40,reasons:e,score:Math.min(100,i)}}catch{return{detected:!1,reasons:[],score:0}}}function P(t){const e=[];return/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g.test(t)&&e.push("信用卡号"),/\b\d{17}[\dxX]\b/g.test(t)&&e.push("身份证号"),/\b1[3-9]\d{9}\b/g.test(t)&&e.push("手机号"),/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g.test(t)&&e.push("邮箱地址"),/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g.test(t)&&e.push("IP地址"),/(password|pwd|passwd)\s*[:=]\s*\S+/gi.test(t)&&e.push("密码"),{detected:e.length>0,types:e}}export{s as T,S as a,h as b,P as c,w as d,C as e,L as f,U as g,M as i};
