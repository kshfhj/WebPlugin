import{d as h,T as o,i as k,a as C,b as a,c as L,e as R,g as w,f as $}from"./security-6RDsp77e.js";class A{observer=null;threatCallback;initialize(){this.setupDOMObserver(),console.log("ğŸ‘ï¸ DOM Observer initialized")}setThreatCallback(t){this.threatCallback=t}setupDOMObserver(){this.observer=new MutationObserver(t=>{t.forEach(e=>{this.handleMutation(e)})}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src","href","onclick","onload","onerror"],characterData:!0})}handleMutation(t){switch(t.type){case"childList":this.handleChildListMutation(t);break;case"attributes":this.handleAttributeMutation(t);break;case"characterData":this.handleCharacterDataMutation(t);break}}handleChildListMutation(t){t.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&this.analyzeAddedElement(e)})}handleAttributeMutation(t){const e=t.target,n=t.attributeName;if(!n)return;const i=e.getAttribute(n);i&&this.isDangerousAttribute(n,i)&&this.reportThreat({id:`dangerous_attribute_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å±æ€§: ${n}="${i.substring(0,50)}"`,timestamp:Date.now(),blocked:!1,details:{element:e.tagName,attribute:n,value:i.substring(0,200)}})}handleCharacterDataMutation(t){const n=t.target.textContent||"",i=h(n);i.detected&&this.reportThreat({id:`text_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"medium",url:window.location.href,description:"æ£€æµ‹åˆ°æ–‡æœ¬å†…å®¹ä¸­çš„XSSæ¨¡å¼",timestamp:Date.now(),blocked:!1,details:{content:n.substring(0,200),patterns:i.patterns.map(r=>r.id)}})}analyzeAddedElement(t){t.tagName==="SCRIPT"&&this.analyzeScriptElement(t),t.tagName==="IFRAME"&&this.analyzeIframeElement(t),t.tagName==="FORM"&&this.analyzeFormElement(t);const e=t.innerHTML;if(e){const n=h(e);n.detected&&this.reportThreat({id:`dynamic_xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:"high",url:window.location.href,description:"æ£€æµ‹åˆ°åŠ¨æ€æ·»åŠ çš„XSSå†…å®¹",timestamp:Date.now(),blocked:!1,details:{element:t.tagName,content:e.substring(0,200),patterns:n.patterns.map(i=>i.id)}})}t.querySelectorAll("*").forEach(n=>{this.analyzeAddedElement(n)})}analyzeScriptElement(t){const e=t.src,n=t.textContent||t.innerHTML;e?this.isTrustedDomain(e)||this.reportThreat({id:`dynamic_external_script_${Date.now()}`,type:"suspicious_script",level:"high",url:window.location.href,description:`åŠ¨æ€åŠ è½½å¤–éƒ¨è„šæœ¬: ${new URL(e).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:e}}):n&&this.reportThreat({id:`dynamic_inline_script_${Date.now()}`,type:"suspicious_script",level:"high",url:window.location.href,description:"åŠ¨æ€æ·»åŠ å†…è”è„šæœ¬",timestamp:Date.now(),blocked:!1,details:{content:n.substring(0,200)}})}analyzeIframeElement(t){const e=t.src;e&&!this.isTrustedDomain(e)&&this.reportThreat({id:`dynamic_iframe_${Date.now()}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`åŠ¨æ€æ·»åŠ å¤–éƒ¨iframe: ${new URL(e).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:e}})}analyzeFormElement(t){const e=t.action;if(e&&e!==window.location.href)try{const n=new URL(e),i=new URL(window.location.href);n.hostname!==i.hostname&&this.reportThreat({id:`dynamic_cross_domain_form_${Date.now()}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`åŠ¨æ€æ·»åŠ è·¨åŸŸè¡¨å•: ${n.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:e}})}catch{}}isDangerousAttribute(t,e){return t.startsWith("on")||(t==="src"||t==="href")&&e.startsWith("javascript:")?!0:h(e).detected}isTrustedDomain(t){try{const e=new URL(t).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com"].some(i=>e===i||e.endsWith("."+i))}catch{return!1}}reportThreat(t){this.threatCallback&&this.threatCallback(t),console.warn("ğŸš¨ DOM Observer detected threat:",t)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null)}}class x{formListeners=new Map;threatCallback;initialize(){console.log("ğŸ“ Form Monitor initialized"),this.setupFormMonitoring()}setThreatCallback(t){this.threatCallback=t}setupFormMonitoring(){document.addEventListener("submit",e=>{e.target instanceof HTMLFormElement&&this.onFormSubmit(e)},!0),new MutationObserver(e=>{e.forEach(n=>{n.addedNodes.forEach(i=>{i instanceof HTMLFormElement?this.monitorForm(i):i instanceof HTMLElement&&i.querySelectorAll("form").forEach(r=>this.monitorForm(r))})})}).observe(document.body,{childList:!0,subtree:!0})}monitorForm(t){if(this.formListeners.has(t))return;const e=n=>{this.onFormSubmit(n)};t.addEventListener("submit",e,!0),this.formListeners.set(t,e)}onFormSubmit(t){const e=t.target,n=this.analyzeFormSubmit(e);if(n.length===0)return;n.some(r=>r.level===o.CRITICAL||r.level===o.HIGH)&&(t.preventDefault(),this.showWarning(n),this.reportThreats(n))}showWarning(t){const e=t.map(n=>`â€¢ ${n.description}`).join(`
`);alert(`âš ï¸ æ£€æµ‹åˆ°å®‰å…¨å¨èƒï¼š

${e}

ä¸ºäº†æ‚¨çš„å®‰å…¨ï¼Œè¡¨å•æäº¤å·²è¢«é˜»æ­¢ã€‚`)}reportThreats(t){typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threats:t}).catch(e=>console.error("Failed to report threats:",e)),this.emitThreats(t)}emitThreats(t){this.threatCallback&&t.forEach(e=>this.threatCallback?.(e))}async scanForms(){const t=[];return document.querySelectorAll("form").forEach((n,i)=>{const r=this.analyzeForm(n,i);t.push(...r)}),t}async checkFormSecurity(t){return k(t)}analyzeFormSubmit(t){const e=[],n=new FormData(t);for(const[i,r]of n.entries()){if(typeof r!="string")continue;const c=C(r);c.detected&&c.patterns.forEach(u=>{e.push({id:`sql_injection_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.SQL_INJECTION,level:u.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${i}" åŒ…å«SQLæ³¨å…¥æ”»å‡»: ${u.description}`,timestamp:Date.now(),blocked:!0,details:{field:i,value:r.substring(0,100),pattern:u.id}})});const l=h(r);l.detected&&l.patterns.forEach(u=>{e.push({id:`xss_form_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.XSS_ATTACK,level:u.severity,url:window.location.href,description:`è¡¨å•å­—æ®µ "${i}" åŒ…å«XSSæ”»å‡»: ${u.description}`,timestamp:Date.now(),blocked:!0,details:{field:i,value:r.substring(0,100),pattern:u.id}})});const p=L(r);p.detected&&!t.action.startsWith("https://")&&e.push({id:`sensitive_data_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.INSECURE_FORM,level:o.HIGH,url:window.location.href,description:`è¡¨å•åœ¨éHTTPSè¿æ¥ä¸‹ä¼ è¾“æ•æ„Ÿä¿¡æ¯: ${p.types.join(", ")}`,timestamp:Date.now(),blocked:!0,details:{field:i,types:p.types}})}return e}analyzeForm(t,e){const n=[],i=t.action||window.location.href,r=t.method.toLowerCase();if(r==="post"&&!i.startsWith("https://")){const c=t.querySelector('input[type="password"]'),l=this.hasSensitiveFields(t);(c||l)&&n.push({id:`insecure_form_${Date.now()}_${e}`,type:a.INSECURE_FORM,level:o.HIGH,url:window.location.href,description:"è¡¨å•åŒ…å«æ•æ„Ÿä¿¡æ¯ä½†æœªä½¿ç”¨HTTPSæäº¤",timestamp:Date.now(),blocked:!1,details:{action:i,method:r,hasPassword:!!c,hasSensitiveFields:l}})}if(i&&i!==window.location.href)try{const c=new URL(i),l=new URL(window.location.href);c.hostname!==l.hostname&&n.push({id:`cross_domain_form_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:o.MEDIUM,url:window.location.href,description:`è¡¨å•æäº¤åˆ°å¤–éƒ¨åŸŸå: ${c.hostname}`,timestamp:Date.now(),blocked:!1,details:{action:i,targetDomain:c.hostname}})}catch{n.push({id:`invalid_form_action_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:o.MEDIUM,url:window.location.href,description:"è¡¨å•actionåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{action:i}})}return n}hasSensitiveFields(t){const e=t.querySelectorAll("input, textarea"),n=[/password/i,/credit.*card/i,/social.*security/i,/ssn/i,/é“¶è¡Œå¡/i,/å¯†ç /i,/èº«ä»½è¯/i,/phone/i,/email/i,/address/i];for(const i of e){const r=i,c=`${r.name} ${r.placeholder} ${r.id}`.toLowerCase();if(n.some(l=>l.test(c))||r instanceof HTMLInputElement&&["password","email","tel"].includes(r.type))return!0}return!1}}class U{suspiciousPatterns=[/eval\s*\(/gi,/document\.write\s*\(/gi,/innerHTML\s*=.*<script/gi,/location\.href\s*=/gi,/window\.open\s*\(/gi,/document\.cookie/gi,/localStorage\./gi,/sessionStorage\./gi];threatCallback;initialize(){console.log("ğŸ“œ Script Monitor initialized"),this.setupRealTimeMonitoring(),this.interceptDangerousFunctions()}setThreatCallback(t){this.threatCallback=t}setupRealTimeMonitoring(){new MutationObserver(e=>{e.forEach(n=>{n.addedNodes.forEach(i=>{i.nodeName==="SCRIPT"&&this.handleDynamicScript(i)})})}).observe(document.documentElement,{childList:!0,subtree:!0})}handleDynamicScript(t){console.warn("âš ï¸ æ£€æµ‹åˆ°åŠ¨æ€æ·»åŠ çš„è„šæœ¬"),t.src?this.analyzeExternalScript(t,0).forEach(e=>{this.reportThreat(e)}):t.textContent&&this.analyzeInlineScript(t,0).forEach(e=>{this.reportThreat(e)})}interceptDangerousFunctions(){const t=document.createElement("script");t.textContent=`
      (function() {
        // ä¿å­˜åŸå§‹å‡½æ•°
        const originalEval = window.eval;
        const originalFunction = window.Function;
        const originalSetTimeout = window.setTimeout;
        const originalSetInterval = window.setInterval;
        
        // æ‹¦æˆªeval
        window.eval = function(...args) {
          console.warn('ğŸš¨ eval() è¢«è°ƒç”¨:', args[0]?.substring(0, 100));
          window.postMessage({
            type: 'WEB_SEC_GUARDIAN_ALERT',
            function: 'eval',
            args: args[0]?.substring(0, 200),
            stack: new Error().stack
          }, '*');
          return originalEval.apply(this, args);
        };
        
        // æ‹¦æˆªFunctionæ„é€ å‡½æ•°
        window.Function = new Proxy(originalFunction, {
          construct(target, args) {
            console.warn('ğŸš¨ Function() è¢«è°ƒç”¨:', args);
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'Function',
              args: JSON.stringify(args).substring(0, 200),
              stack: new Error().stack
            }, '*');
            return new target(...args);
          }
        });
        
        // æ‹¦æˆªsetTimeoutä¸­çš„å­—ç¬¦ä¸²
        window.setTimeout = function(handler, ...args) {
          if (typeof handler === 'string') {
            console.warn('ğŸš¨ setTimeoutæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'setTimeout',
              args: handler.substring(0, 200)
            }, '*');
          }
          return originalSetTimeout.call(this, handler, ...args);
        };
        
        // æ‹¦æˆªsetIntervalä¸­çš„å­—ç¬¦ä¸²
        window.setInterval = function(handler, ...args) {
          if (typeof handler === 'string') {
            console.warn('ğŸš¨ setIntervalæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç :', handler.substring(0, 100));
            window.postMessage({
              type: 'WEB_SEC_GUARDIAN_ALERT',
              function: 'setInterval',
              args: handler.substring(0, 200)
            }, '*');
          }
          return originalSetInterval.call(this, handler, ...args);
        };
        
        console.log('ğŸ›¡ï¸ Web Security Guardian - å±é™©å‡½æ•°ç›‘æ§å·²æ¿€æ´»');
      })();
    `,(document.head||document.documentElement).insertBefore(t,(document.head||document.documentElement).firstChild),t.remove(),window.addEventListener("message",e=>{if(e.source===window&&e.data.type==="WEB_SEC_GUARDIAN_ALERT"){const n={id:`dangerous_function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a.XSS_ATTACK,level:o.HIGH,url:window.location.href,description:`æ£€æµ‹åˆ°å±é™©å‡½æ•°è°ƒç”¨: ${e.data.function}()`,timestamp:Date.now(),blocked:!1,details:{function:e.data.function,args:e.data.args,stack:e.data.stack}};this.reportThreat(n)}})}reportThreat(t){this.threatCallback&&this.threatCallback(t),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:t}).catch(e=>console.error("Failed to report threat:",e))}async scanScripts(){const t=[];return document.querySelectorAll("script:not([src])").forEach((i,r)=>{const c=this.analyzeInlineScript(i,r);t.push(...c)}),document.querySelectorAll("script[src]").forEach((i,r)=>{const c=this.analyzeExternalScript(i,r);t.push(...c)}),t}analyzeInlineScript(t,e){const n=[],i=t.textContent||t.innerHTML||"";return i.trim()&&(this.suspiciousPatterns.forEach((r,c)=>{const l=i.match(r);l&&n.push({id:`suspicious_inline_script_${Date.now()}_${e}_${c}`,type:a.SUSPICIOUS_SCRIPT,level:this.getPatternSeverity(r),url:window.location.href,description:`å†…è”è„šæœ¬åŒ…å«å¯ç–‘ä»£ç : ${this.getPatternDescription(r)}`,timestamp:Date.now(),blocked:!1,details:{pattern:r.toString(),matches:l.slice(0,3),scriptContent:i.substring(0,200)}})}),i.length>1e4&&this.isObfuscated(i)&&n.push({id:`obfuscated_script_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:o.MEDIUM,url:window.location.href,description:"æ£€æµ‹åˆ°å¯èƒ½çš„æ··æ·†è„šæœ¬ä»£ç ",timestamp:Date.now(),blocked:!1,details:{scriptLength:i.length,scriptPreview:i.substring(0,100)}})),n}analyzeExternalScript(t,e){const n=[],i=t.src;if(!i)return n;try{const r=new URL(i);this.isTrustedDomain(r.hostname)||n.push({id:`untrusted_external_script_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:o.MEDIUM,url:window.location.href,description:`åŠ è½½æ¥è‡ªä¸å¯ä¿¡åŸŸåçš„è„šæœ¬: ${r.hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i,domain:r.hostname}}),r.protocol==="http:"&&window.location.protocol==="https:"&&n.push({id:`mixed_content_script_${Date.now()}_${e}`,type:a.INSECURE_FORM,level:o.MEDIUM,url:window.location.href,description:"HTTPSé¡µé¢åŠ è½½HTTPè„šæœ¬ï¼ˆæ··åˆå†…å®¹ï¼‰",timestamp:Date.now(),blocked:!1,details:{src:i}})}catch{n.push({id:`invalid_script_src_${Date.now()}_${e}`,type:a.SUSPICIOUS_SCRIPT,level:o.HIGH,url:window.location.href,description:"è„šæœ¬srcåŒ…å«æ— æ•ˆURL",timestamp:Date.now(),blocked:!1,details:{src:i}})}return n}getPatternSeverity(t){const e=t.toString();return e.includes("eval")?o.HIGH:e.includes("document.write")?o.MEDIUM:e.includes("innerHTML.*<script")?o.HIGH:e.includes("location.href")?o.MEDIUM:e.includes("document.cookie")?o.MEDIUM:o.LOW}getPatternDescription(t){const e=t.toString();return e.includes("eval")?"eval()å‡½æ•°è°ƒç”¨":e.includes("document.write")?"document.write()è°ƒç”¨":e.includes("innerHTML.*<script")?"innerHTMLæ³¨å…¥è„šæœ¬":e.includes("location.href")?"é¡µé¢é‡å®šå‘":e.includes("document.cookie")?"Cookieè®¿é—®":e.includes("localStorage")?"localStorageè®¿é—®":e.includes("sessionStorage")?"sessionStorageè®¿é—®":"å¯ç–‘ä»£ç æ¨¡å¼"}isObfuscated(t){return[/[a-zA-Z_$][a-zA-Z0-9_$]*\s*=\s*['"]\w+['"]/.test(t),t.split(`
`).length<10&&t.length>5e3,/\\x[0-9a-fA-F]{2}/.test(t),/\\u[0-9a-fA-F]{4}/.test(t),(t.match(/[{}]/g)||[]).length>t.length*.1].filter(Boolean).length>=2}isTrustedDomain(t){return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net","stackpath.bootstrapcdn.com","maxcdn.bootstrapcdn.com","fonts.googleapis.com","use.fontawesome.com"].some(n=>t===n||t.endsWith("."+n))}}class F{threats=[];initialize(){console.log("ğŸ“Š Page Analyzer initialized")}async scanPage(){return this.threats=[],await this.scanContent(),await this.scanExternalResources(),await this.scanUrl(),this.threats}async analyzePage(){const t=await this.scanPage(),e=R(t);return{url:window.location.href,score:e,threats:t,recommendations:this.generateRecommendations(t),scanTime:Date.now(),isSecure:t.length===0}}async scanContent(){const t=document.documentElement.innerHTML,e=h(t);e.detected&&e.patterns.forEach(n=>{this.threats.push({id:`xss_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"xss_attack",level:n.severity,url:window.location.href,description:`æ£€æµ‹åˆ°XSSæ¨¡å¼: ${n.description}`,timestamp:Date.now(),blocked:!1,details:{pattern:n.id}})})}async scanExternalResources(){document.querySelectorAll("script[src]").forEach(n=>{const i=n.src;i&&!this.isTrustedDomain(i)&&this.threats.push({id:`external_script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨è„šæœ¬: ${new URL(i).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i}})}),document.querySelectorAll("iframe[src]").forEach(n=>{const i=n.src;i&&!this.isTrustedDomain(i)&&this.threats.push({id:`external_iframe_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"suspicious_script",level:"medium",url:window.location.href,description:`æ£€æµ‹åˆ°å¤–éƒ¨iframe: ${new URL(i).hostname}`,timestamp:Date.now(),blocked:!1,details:{src:i}})})}async scanUrl(){const t=window.location.href;!t.startsWith("https://")&&!t.startsWith("file://")&&this.threats.push({id:`insecure_protocol_${Date.now()}`,type:"insecure_form",level:"medium",url:t,description:"ç½‘ç«™æœªä½¿ç”¨HTTPSåŠ å¯†è¿æ¥",timestamp:Date.now(),blocked:!1})}isTrustedDomain(t){try{const e=new URL(t).hostname;return[window.location.hostname,"cdnjs.cloudflare.com","ajax.googleapis.com","code.jquery.com","unpkg.com","jsdelivr.net"].some(i=>e===i||e.endsWith("."+i))}catch{return!1}}generateRecommendations(t){const e=[],n=new Set(t.map(i=>i.type));return n.has("xss_attack")&&e.push("æ£€æµ‹åˆ°XSSé£é™©ï¼Œå»ºè®®æ›´æ–°æµè§ˆå™¨å¹¶å¯ç”¨å®‰å…¨é˜²æŠ¤"),n.has("suspicious_script")&&e.push("å‘ç°å¯ç–‘å¤–éƒ¨èµ„æºï¼Œè¯·ç¡®è®¤ç½‘ç«™å¯ä¿¡åº¦"),n.has("insecure_form")&&e.push("ç½‘ç«™æœªä½¿ç”¨HTTPSï¼Œé¿å…è¾“å…¥æ•æ„Ÿä¿¡æ¯"),e.length===0&&e.push("é¡µé¢å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼Œä½†ä»éœ€ä¿æŒè­¦æƒ•"),e}}console.log("ğŸ›¡ï¸ Web Security Guardian å†…å®¹è„šæœ¬å¯åŠ¨:",window.location.href);const S=new A,f=new x,g=new U,b=new F,T=new Set,_=new Set,E=new Set,m=[];function v(){return typeof chrome<"u"&&!!chrome.runtime?.sendMessage}function P(s){v()&&(_.has(s.id)||(_.add(s.id),chrome.runtime.sendMessage({type:"THREAT_DETECTED",threat:s}).catch(t=>console.error("Failed to notify background:",t))))}function z(s){switch(s){case a.MALICIOUS_URL:return"æ¶æ„ç½‘å€";case a.XSS_ATTACK:return"XSSæ”»å‡»";case a.SQL_INJECTION:return"SQLæ³¨å…¥";case a.TRACKER:return"è¿½è¸ªå™¨";case a.INSECURE_FORM:return"ä¸å®‰å…¨ä¼ è¾“";case a.SUSPICIOUS_SCRIPT:return"å¯ç–‘è„šæœ¬";case a.PHISHING:return"é’“é±¼é£é™©";case a.DATA_LEAK:return"æ•æ„Ÿä¿¡æ¯æ³„éœ²";default:return"å®‰å…¨è­¦å‘Š"}}function H(s){switch(s){case o.CRITICAL:return"linear-gradient(135deg, #ff1744, #b71c1c)";case o.HIGH:return"linear-gradient(135deg, #ff6b6b, #d32f2f)";case o.MEDIUM:return"linear-gradient(135deg, #ffb74d, #f57c00)";case o.LOW:return"linear-gradient(135deg, #66bb6a, #2e7d32)";default:return"linear-gradient(135deg, #607d8b, #455a64)"}}function M(s){if(!document.body){m.push(s);return}let t=s.url;try{t=new URL(s.url).hostname}catch{}const e="wsg-threat-container";let n=document.getElementById(e);n||(n=document.createElement("div"),n.id=e,n.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100000;
      max-width: 340px;
      pointer-events: none;
    `,document.body.appendChild(n));const i=document.createElement("div");i.style.cssText=`
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    border-radius: 14px;
    color: #fff;
    box-shadow: 0 14px 28px rgba(0,0,0,0.25);
    background: ${H(s.level)};
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 13px;
    line-height: 1.5;
    pointer-events: auto;
    position: relative;
    overflow: hidden;
  `,i.innerHTML=`
    <div style="font-size: 20px; line-height: 1;">ğŸ›¡ï¸</div>
    <div style="flex: 1; min-width: 0;">
      <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">
        ${z(s.type)} Â· ${s.level.toUpperCase()}
      </div>
      <div style="font-size: 13px; word-break: break-word;">${s.description}</div>
      <div style="margin-top: 6px; font-size: 12px; opacity: 0.85;">
        æ¥æºï¼š${t}
      </div>
    </div>
    <button type="button" aria-label="å…³é—­è­¦å‘Š"
      style="background: transparent; border: none; color: #fff; font-size: 18px; cursor: pointer; line-height: 1;">Ã—</button>
  `,i.querySelector("button")?.addEventListener("click",c=>{c.stopPropagation(),i.remove()}),n.appendChild(i),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(20px)",setTimeout(()=>i.remove(),300)},6e3)}function O(){if(!m.length)return;const s=[...m];m.length=0,s.forEach(M)}function d(s,t={}){console.warn("ğŸš¨ Web Security Guardian Threat Detected:",s);const e=N(s);T.has(s.id)||T.add(s.id),E.has(e)||(E.add(e),M(s)),t.notifyBackground&&P(s)}function N(s){let t=s.url;try{t=new URL(s.url).hostname}catch{}const n=["pattern","field","src","function","args"].map(i=>typeof s.details?.[i]=="string"?s.details?.[i]:"").filter(Boolean);return[s.type,t,s.description,...n].join("|").toLowerCase()}const y=document.createElement("meta");y.name="web-security-guardian";y.content="active";document.head?.appendChild(y);window.webSecurityGuardian={version:"1.0.0",isActive:!0,reportThreat:s=>{const t={id:s.id||w(),type:s.type||a.DATA_LEAK,level:s.level||o.MEDIUM,url:s.url||window.location.href,description:s.description||"æ£€æµ‹åˆ°æœªçŸ¥å®‰å…¨å¨èƒ",timestamp:s.timestamp||Date.now(),blocked:s.blocked??!1,details:s.details};d(t,{notifyBackground:!0})}};function G(){if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"&&!window.location.hostname.startsWith("127.0.0.")){const s={id:w(),type:a.INSECURE_FORM,level:o.MEDIUM,url:window.location.href,description:"å½“å‰é¡µé¢æœªä½¿ç”¨HTTPSåŠ å¯†è¿æ¥ï¼Œè°¨æ…è¾“å…¥æ•æ„Ÿä¿¡æ¯",timestamp:Date.now(),blocked:!1};d(s,{notifyBackground:!0})}}function I(s,t){try{const e=new URL(s,window.location.href).href,n=$(e);if(n.detected){const i={id:w(),type:a.PHISHING,level:n.score>=80?o.CRITICAL:o.HIGH,url:e,description:`æ£€æµ‹åˆ°ç–‘ä¼¼é’“é±¼é“¾æ¥ï¼ˆæ¥æºï¼š${t}ï¼‰`,timestamp:Date.now(),blocked:!0,details:{reasons:n.reasons,score:n.score,source:t}};return d(i,{notifyBackground:!0}),console.warn("ğŸ£ é’“é±¼é£é™©è¯¦æƒ…:",n.reasons),!0}}catch(e){console.warn("æ— æ³•è§£æURLè¿›è¡Œå®‰å…¨æ£€æŸ¥:",s,e)}return!1}function W(){document.addEventListener("click",s=>{if(!(s.target instanceof Element))return;const t=s.target.closest("a[href]");if(!t)return;const e=t.href;I(e,"anchor_click")&&(s.preventDefault(),s.stopImmediatePropagation())},!0)}function B(){const s=window.open;window.open=function(...t){const e=t[0],n=typeof e=="string"?e:e?.toString?.();return typeof n=="string"&&I(n,"window.open")?null:s.apply(window,t)}}function D(){O(),S.setThreatCallback(s=>d(s,{notifyBackground:!0})),S.initialize(),f.setThreatCallback(s=>d(s)),f.initialize(),b.initialize(),b.analyzePage().then(s=>{s.threats.length>0&&s.threats.forEach(t=>d(t,{notifyBackground:!0})),v()&&chrome.runtime.sendMessage({type:"PAGE_ANALYZED",analysis:s}).catch(t=>console.error("Failed to send PAGE_ANALYZED message:",t))}),G(),g.scanScripts().then(s=>{s.forEach(t=>d(t,{notifyBackground:!0}))}),f.scanForms().then(s=>{s.forEach(t=>d(t,{notifyBackground:!0}))}),W(),console.log("âœ… Web Security Guardian å†…å®¹è„šæœ¬å·²æ¿€æ´»")}g.setThreatCallback(s=>d(s));g.initialize();B();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();
